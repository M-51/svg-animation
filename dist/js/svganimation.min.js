var SVGAnimation=function(){"use strict";function t(t){return void 0===t}function e(t){return!Number.isNaN(parseFloat(t))&&Number.isFinite(t)}function n(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function a(t,...e){e.forEach(e=>{t.setAttributeNS(null,e[0],e[1])})}function i(t){let e=t.item;for(;e.tagName;){if("svg"===e.tagName.toLowerCase())return e;e=e.parentNode}throw new Error("Cannot find SVG element! All animated elements must have SVG parent")}function r(e){const n={};return Object.keys(E).forEach(a=>{t(e)||t(e[a])?n[a]=E[a]:n[a]=e[a]}),n}function s(t,e){const n=[];return Array.isArray(e.animation[t])?e.animation[t].forEach(a=>{n.push([t,a,e])}):n.push([t,e.animation[t],e]),n}function o(t){const e=[];return t.forEach(t=>{Object.keys(t.animation).forEach(n=>{e.push(...s(n,t))})}),e}function c(t,e,n){const a=t;return a.e=e,a.f=n,a}function l(t,e,n){const a=t,i=Math.sin(e)*n,r=Math.cos(e)*n;return a.a=r,a.b=-i,a.c=i,a.d=r,a}function h(t,e,n){const a=t,i=Math.sin(n)*e,r=Math.cos(n)*e;return a.a=r,a.b=-i,a.c=i,a.d=r,a}function u(t,e,n,a,i){const r=t,s=Math.sin(a)*i,o=Math.cos(a)*i;return r.a=o,r.b=-s,r.c=s,r.d=o,r.e=e,r.f=n,r}function f(t,e,n,a,i){const r=t,s=Math.sin(i)*a,o=Math.cos(i)*a;return r.a=o,r.b=-s,r.c=s,r.d=o,r.e=e,r.f=n,r}function m(t,e,n){const a=t,i=Math.sin(n)*e,r=Math.cos(n)*e;return a.a=r,a.b=-i,a.c=i,a.d=r,a}function p(t,e,n,a,i){const r=t,s=Math.sin(i)*a,o=Math.cos(i)*a;return r.a=o,r.b=-s,r.c=s,r.d=o,r.e=e,r.f=n,r}function d(t,e){function n(t){return r.indexOf(t)}const a=t.transform,i=a.translate,r=Object.keys(e);let s;return-1!==n("translate")&&-1===n("rotate")&&-1===n("scale")?s=(n=>{i.x=e.translate.x(n),i.y=e.translate.y(n);const a=c(t.matrix,i.x,i.y);t.setMatrix(a)}):-1===n("translate")&&-1!==n("rotate")&&-1===n("scale")?s=(n=>{a.rotate=e.rotate(n);const i=l(t.matrix,a.rotate,a.scale);t.setMatrix(i)}):-1===n("translate")&&-1===n("rotate")&&-1!==n("scale")?s=(n=>{a.scale=e.scale(n);const i=h(t.matrix,a.scale,a.rotate);t.setMatrix(i)}):-1!==n("translate")&&-1!==n("rotate")&&-1===n("scale")?s=(n=>{i.x=e.translate.x(n),i.y=e.translate.y(n);const r=e.rotate(n),s=u(t.matrix,i.x,i.y,r,a.scale);t.setMatrix(s)}):-1!==n("translate")&&-1===n("rotate")&&-1!==n("scale")?s=(n=>{i.x=e.translate.x(n),i.y=e.translate.y(n),a.scale=e.scale(n);const r=f(t.matrix,i.x,i.y,a.scale,a.rotate);t.setMatrix(r)}):-1===n("translate")&&-1!==n("rotate")&&-1!==n("scale")?s=(n=>{a.rotate=e.rotate(n),a.scale=e.scale(n);const i=m(t.matrix,a.scale,a.rotate);t.setMatrix(i)}):-1!==n("translate")&&-1!==n("rotate")&&-1!==n("scale")&&(s=(n=>{i.x=e.translate.x(n),i.y=e.translate.y(n),a.rotate=e.rotate(n),a.scale=e.scale(n);const r=p(t.matrix,i.x,i.y,a.scale,a.rotate);t.setMatrix(r)})),s}function g(t,e,n){return a=>{const{value:i}=n;t.setAttribute(e,i(a))}}function y(t){const e=[];return t.forEach(t=>{const[n,a,i]=t;"transform"===n?e.push([d(i,a),a]):e.push([g(i,n,a),a])}),e}function b(t,e){let n;return n=e.local?n=>{n>=e.range[0]&&t(n-e.range[0])}:n=>{n>=e.range[0]&&t(n)}}function x(t,e,n){let a;return a=e.local?i=>{i>=e.range[0]&&i<=e.range[1]?t(i-e.range[0]):i>e.range[1]&&n(a)}:i=>{i>=e.range[0]&&i<=e.range[1]?t(i):i>e.range[1]&&n(a)}}function w(t,e,n){let a;return a=e.local?i=>{i>=e.range&&(t(i-e.range),n(a))}:i=>{i>=e.range&&(t(i),n(a))}}function M(t,n,a){let i;const{range:r}=n;return Array.isArray(r)?1===r.length?i=b(t,n):2===r.length&&(i=x(t,n,a)):e(r)&&(i=w(t,n,a)),i}function C(t,e){const n=[];return t.forEach(t=>{const[a,i]=t;i.range?n.push(M(a,i,e)):n.push(a)}),n}function A(t,e){const i=n("g"),r=n("polygon"),s=n("polygon");a(r,["points","-10,-10 -10,10 0,-5 0,5"]),a(s,["points","-10,-10 -10,10 10,0 10,0"]),i.appendChild(r),i.appendChild(s);const o=n("rect");a(o,["x","-10"],["y","-10"],["width","20"],["height","20"],["fill-opacity","0"]);const c=n("g");return c.appendChild(i),c.appendChild(o),function(){const t=e.viewBox.baseVal,n=e.createSVGMatrix();n.e=t.x+25,n.f=t.y+(t.height-25),c.transform.baseVal.initialize(e.createSVGTransformFromMatrix(n))}(),function(){a(i,["fill",t.interfaceColor]);const{matrix:e}=c.transform.baseVal.getItem(0);e.a=t.interfaceSize,e.d=t.interfaceSize,"auto"!==t.interfacePosition&&([e.e,e.f]=t.interfacePosition),c.transform.baseVal.getItem(0).setMatrix(e)}(),e.appendChild(c),{play:function(){a(r,["points","-10,-10 -10,10 0,-5 0,5"]),a(s,["points","-10,-10 -10,10 10,0 10,0"])},pause:function(){a(r,["points","-9,-10 -9,10 -2,10 -2,-10"]),a(s,["points","2,-10 2,10 9,10 9,-10"])},off:function(){a(i,["display","none"])},on:function(){a(r,["points","-10,-10 -10,10 0,-5 0,5"]),a(s,["points","-10,-10 -10,10 10,0 10,0"]),a(i,["display","block"])},button:o}}function V(t,e){const i=n("marker");i.id="arrow",a(i,["viewBox","0 0 10 10"],["refX","1"],["refY","5"],["markerWidth","3"],["markerHeight","3"],["orient","auto"]);const r=n("path");a(r,["d","M 0 0 L 10 5 L 0 10 z"]),i.appendChild(r);const s=n("g"),o=n("path"),c=n("path");a(o,["d","M-10 0 A 10 10 0 0 1 0 -10"],["marker-end","url(#arrow)"]),a(c,["d","M10 0 A 10 10 0 0 1 0 10"],["marker-end","url(#arrow)"]),s.appendChild(o),s.appendChild(c),a(s,["fill","none"],["stroke-width","2"],["transform","translate(30, 0)"]);const l=n("rect");a(l,["x","-10"],["y","-10"],["width","20"],["height","20"],["fill-opacity","0"],["transform","translate(30, 0)"]);const h=n("g");h.appendChild(s),h.appendChild(l);let u=e.getElementsByTagName("defs")[0];return u||(u=n("defs"),e.insertBefore(u,e.firstChild)),function(){const t=e.viewBox.baseVal,n=e.createSVGMatrix();n.e=t.x+25,n.f=t.y+(t.height-25),h.transform.baseVal.initialize(e.createSVGTransformFromMatrix(n))}(),function(){a(s,["stroke",t.interfaceColor]),a(i,["fill",t.interfaceColor]);const{matrix:e}=h.transform.baseVal.getItem(0);e.a=t.interfaceSize,e.d=t.interfaceSize,"auto"!==t.interfacePosition&&([e.e,e.f]=t.interfacePosition),h.transform.baseVal.getItem(0).setMatrix(e)}(),u.appendChild(i),e.appendChild(h),{off:function(){a(s,["display","none"])},on:function(){a(s,["display","block"])},button:l}}function v(t){const e=new Map,{attributes:n}=t;for(let t=0;t<n.length;t+=1)n[t].specified&&e.set(n[t].name,parseFloat(n[t].value)||n[t].value);return e}function I(t,e){for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name);e.forEach((e,n)=>{t.setAttribute(n,e)})}function S(t,e){let n=null;const a=t.transform.baseVal;a.length?(a.consolidate(),({matrix:n}=a.getItem(0))):n=e.createSVGMatrix(),a.initialize(e.createSVGTransformFromMatrix(n))}function j(t){const e={};return e.translate={x:t.e,y:t.f},e.scale=Math.sign(t.a)*Math.sqrt(t.a*t.a+t.c*t.c),e.rotate=Math.atan2(-t.c,t.a)*(180/Math.PI),e}const E={showInterface:!0,interfaceAnimation:!0,interfaceSize:1,interfaceColor:"#000",interfacePosition:"auto",restartAtTheEnd:!1};class k{constructor(t){this.status="not started",this.timer={animationId:0,startTime:0,time:0},this.settings=r(t),this.objectList=new Set,this.loop=[]}reset(){this.objectList.forEach(t=>{t.resetAttributes(),t.setVariables(),t.initMatrix(this.svg),t.decomposeMatrix()}),this.loop=[],this.dispatcher(this.objectList)}}class F{constructor(t){this.item=t}setVariables(){this.variables=v(this.item)}initMatrix(t){S(this.item,t),this.matrix=this.item.transform.baseVal.getItem(0).matrix,this.SVGTransform=this.item.transform.baseVal.getItem(0)}resetAttributes(){I(this.item,this.variables)}decomposeMatrix(){this.transform=j(this.matrix)}setMatrix(t){this.SVGTransform.setMatrix(t)}setAttribute(t,e){this.item.setAttributeNS(null,t,e)}}return k.prototype.play=function(){function t(){e.timer.time=Date.now()-e.timer.startTime,e.frame(e.timer.time/1e3),e.timer.animationId=window.requestAnimationFrame(t)}const e=this;"not started"===this.status?(this.status="playing",this.timer.startTime=Date.now(),this.timer.animationId=window.requestAnimationFrame(t),this.settings.showInterface&&(this.interfaceControler.playPause.pause(),this.interfaceControler.refresh.on())):"paused"===this.status&&(this.status="playing",this.timer.startTime=Date.now()-this.timer.time,this.timer.animationId=window.requestAnimationFrame(t),this.settings.showInterface&&this.interfaceControler.playPause.pause())},k.prototype.pause=function(){"playing"===this.status&&(this.status="paused",window.cancelAnimationFrame(this.timer.animationId),this.settings.showInterface&&this.interfaceControler.playPause.play())},k.prototype.refresh=function(){"playing"!==this.status&&"paused"!==this.status&&"ended"!==this.status||(this.status="not started",window.cancelAnimationFrame(this.timer.animationId),this.timer.startTime=0,this.timer.time=0,this.settings.showInterface&&(this.interfaceControler.playPause.on(),this.interfaceControler.refresh.off()),this.reset())},k.prototype.end=function(){if("playing"===this.status||"paused"===this.status){this.status="ended";const t=this;window.setTimeout(()=>{window.cancelAnimationFrame(t.timer.animationId),t.settings.restartAtTheEnd&&t.refresh(),this.settings.showInterface&&this.interfaceControler.playPause.off()},25)}},k.prototype.frame=function(t){for(let e=0;e<this.loop.length;e+=1)this.loop[e](t)},k.prototype.dispatcher=function(t){const e=y(o(t)),n=this.deleteItemFromLoop.bind(this);this.loop.push(...C(e,n))},k.prototype.deleteItemFromLoop=function(t){this.loop.splice(this.loop.indexOf(t),1),this.loop<1&&this.end()},k.prototype.interfaceControler=function(){const t=A(this.settings,this.svg),e=V(this.settings,this.svg);e.off();const n=this;return t.button.addEventListener("click",function(){"not started"===n.status||"paused"===n.status?n.play():"playing"===n.status&&n.pause()},!1),e.button.addEventListener("click",function(){"playing"!==n.status&&"paused"!==n.status&&"ended"!==n.status||n.refresh()},!1),{playPause:t,refresh:e}},k.prototype.add=function(...t){const e=new Set;t.forEach(t=>{if(!Object.prototype.hasOwnProperty.call(t,"object"))throw new Error(`Object ${t} must have "object" property. which is query selector or actual DOM object`);const n="string"==typeof t.object?document.querySelector(t.object):t.object;if(!document.contains(n))throw new Error(`Cannot find ${"string"==typeof t.object?`DOM element that match "${t.object}" query selector`:`${t.object} in DOM`}`);const a=new F(n);if(!Object.prototype.hasOwnProperty.call(t,"animation"))throw new Error(`Object ${t} must have "animation" property`);a.animation=t.animation,this.svg||(this.svg=i(a)),e.add(a),a.setVariables(),a.initMatrix(this.svg),a.decomposeMatrix(),this.objectList.add(a)}),"function"==typeof this.interfaceControler&&this.settings.showInterface&&(this.interfaceControler=this.interfaceControler()),this.dispatcher(e)},k}();