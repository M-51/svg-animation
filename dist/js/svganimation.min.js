var SVGAnimation=function(){"use strict";function t(t){return void 0===t}function e(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function n(t,...e){e.forEach(e=>{t.setAttributeNS(null,e[0],e[1])})}function i(t){const e=[];return t.forEach(t=>{Object.keys(t.animation).forEach(n=>{e.push(...function(t,e){const n=[];return Array.isArray(e.animation[t])?e.animation[t].forEach(i=>{n.push([t,i,e])}):n.push([t,e.animation[t],e]),n}(n,t))})}),e}function a(t,e){function n(t){return s.indexOf(t)}const i=t.transform,a=i.translate,s=Object.keys(e);let r;return-1!==n("translate")&&-1===n("rotate")&&-1===n("scale")?r=(n=>{a.x=e.translate.x(n),a.y=e.translate.y(n);const i=function(t,e,n){const i=t;return i.e=e,i.f=n,i}(t.matrix,a.x,a.y);t.setMatrix(i)}):-1===n("translate")&&-1!==n("rotate")&&-1===n("scale")?r=(n=>{i.rotate=e.rotate(n);const a=function(t,e,n){const i=t,a=Math.sin(e)*n,s=Math.cos(e)*n;return i.a=s,i.b=-a,i.c=a,i.d=s,i}(t.matrix,i.rotate,i.scale);t.setMatrix(a)}):-1===n("translate")&&-1===n("rotate")&&-1!==n("scale")?r=(n=>{i.scale=e.scale(n);const a=function(t,e,n){const i=t,a=Math.sin(n)*e,s=Math.cos(n)*e;return i.a=s,i.b=-a,i.c=a,i.d=s,i}(t.matrix,i.scale,i.rotate);t.setMatrix(a)}):-1!==n("translate")&&-1!==n("rotate")&&-1===n("scale")?r=(n=>{a.x=e.translate.x(n),a.y=e.translate.y(n);const s=e.rotate(n),r=function(t,e,n,i,a){const s=t,r=Math.sin(i)*a,o=Math.cos(i)*a;return s.a=o,s.b=-r,s.c=r,s.d=o,s.e=e,s.f=n,s}(t.matrix,a.x,a.y,s,i.scale);t.setMatrix(r)}):-1!==n("translate")&&-1===n("rotate")&&-1!==n("scale")?r=(n=>{a.x=e.translate.x(n),a.y=e.translate.y(n),i.scale=e.scale(n);const s=function(t,e,n,i,a){const s=t,r=Math.sin(a)*i,o=Math.cos(a)*i;return s.a=o,s.b=-r,s.c=r,s.d=o,s.e=e,s.f=n,s}(t.matrix,a.x,a.y,i.scale,i.rotate);t.setMatrix(s)}):-1===n("translate")&&-1!==n("rotate")&&-1!==n("scale")?r=(n=>{i.rotate=e.rotate(n),i.scale=e.scale(n);const a=function(t,e,n){const i=t,a=Math.sin(n)*e,s=Math.cos(n)*e;return i.a=s,i.b=-a,i.c=a,i.d=s,i}(t.matrix,i.scale,i.rotate);t.setMatrix(a)}):-1!==n("translate")&&-1!==n("rotate")&&-1!==n("scale")&&(r=(n=>{a.x=e.translate.x(n),a.y=e.translate.y(n),i.rotate=e.rotate(n),i.scale=e.scale(n);const s=function(t,e,n,i,a){const s=t,r=Math.sin(a)*i,o=Math.cos(a)*i;return s.a=o,s.b=-r,s.c=r,s.d=o,s.e=e,s.f=n,s}(t.matrix,a.x,a.y,i.scale,i.rotate);t.setMatrix(s)})),r}function s(t,e,n){let i;const{range:a}=e;return Array.isArray(a)?1===a.length?i=function(t,e){let n;return n=e.local?n=>{n>=e.range[0]&&t(n-e.range[0])}:n=>{n>=e.range[0]&&t(n)}}(t,e):2===a.length&&(i=function(t,e,n){let i;return i=e.local?a=>{a>=e.range[0]&&a<=e.range[1]?t(a-e.range[0]):a>e.range[1]&&n(i)}:a=>{a>=e.range[0]&&a<=e.range[1]?t(a):a>e.range[1]&&n(i)}}(t,e,n)):function(t){return!Number.isNaN(parseFloat(t))&&Number.isFinite(t)}(a)&&(i=function(t,e,n){let i;return i=e.local?a=>{a>=e.range&&(t(a-e.range),n(i))}:a=>{a>=e.range&&(t(a),n(i))}}(t,e,n)),i}const r={showInterface:!0,interfaceAnimation:!0,interfaceSize:1,interfaceColor:"#000",interfacePosition:"auto",restartAtTheEnd:!1};class o{constructor(e){this.status="not started",this.timer={animationId:0,startTime:0,time:0},this.settings=function(e){const n={};return Object.keys(r).forEach(i=>{t(e)||t(e[i])?n[i]=r[i]:n[i]=e[i]}),n}(e),this.objectList=new Set,this.loop=[]}reset(){this.objectList.forEach(t=>{t.resetAttributes(),t.setVariables(),t.initMatrix(this.svg),t.decomposeMatrix()}),this.loop=[],this.dispatcher(this.objectList)}}class c{constructor(t){this.item=t}setVariables(){this.variables=function(t){const e=new Map,{attributes:n}=t;for(let t=0;t<n.length;t+=1)n[t].specified&&e.set(n[t].name,parseFloat(n[t].value)||n[t].value);return e}(this.item)}initMatrix(t){!function(t,e){let n=null;const i=t.transform.baseVal;i.length?(i.consolidate(),({matrix:n}=i.getItem(0))):n=e.createSVGMatrix(),i.initialize(e.createSVGTransformFromMatrix(n))}(this.item,t),this.matrix=this.item.transform.baseVal.getItem(0).matrix,this.SVGTransform=this.item.transform.baseVal.getItem(0)}resetAttributes(){!function(t,e){for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name);e.forEach((e,n)=>{t.setAttribute(n,e)})}(this.item,this.variables)}decomposeMatrix(){this.transform=function(t){const e={};return e.translate={x:t.e,y:t.f},e.scale=Math.sign(t.a)*Math.sqrt(t.a*t.a+t.c*t.c),e.rotate=Math.atan2(-t.c,t.a)*(180/Math.PI),e}(this.matrix)}setMatrix(t){this.SVGTransform.setMatrix(t)}setAttribute(t,e){this.item.setAttributeNS(null,t,e)}}return o.prototype.play=function(){function t(){e.timer.time=Date.now()-e.timer.startTime,e.frame(e.timer.time/1e3),e.timer.animationId=window.requestAnimationFrame(t)}const e=this;"not started"===this.status?(this.status="playing",this.timer.startTime=Date.now(),this.timer.animationId=window.requestAnimationFrame(t),this.settings.showInterface&&(this.interfaceControler.playPause.pause(),this.interfaceControler.refresh.on())):"paused"===this.status&&(this.status="playing",this.timer.startTime=Date.now()-this.timer.time,this.timer.animationId=window.requestAnimationFrame(t),this.settings.showInterface&&this.interfaceControler.playPause.pause())},o.prototype.pause=function(){"playing"===this.status&&(this.status="paused",window.cancelAnimationFrame(this.timer.animationId),this.settings.showInterface&&this.interfaceControler.playPause.play())},o.prototype.refresh=function(){"playing"!==this.status&&"paused"!==this.status&&"ended"!==this.status||(this.settings.showInterface&&("playing"===this.status?this.interfaceControler.playPause.play():"ended"===this.status&&this.interfaceControler.playPause.on(),this.interfaceControler.refresh.off()),this.status="not started",window.cancelAnimationFrame(this.timer.animationId),this.timer.startTime=0,this.timer.time=0,this.reset())},o.prototype.end=function(){if("playing"===this.status||"paused"===this.status){this.status="ended";const t=this;window.setTimeout(()=>{window.cancelAnimationFrame(t.timer.animationId),t.settings.restartAtTheEnd&&t.refresh(),this.settings.showInterface&&this.interfaceControler.playPause.off()},25)}},o.prototype.frame=function(t){for(let e=0;e<this.loop.length;e+=1)this.loop[e](t)},o.prototype.dispatcher=function(t){const e=function(t){const e=[];return t.forEach(t=>{const[n,i,s]=t;"transform"===n?e.push([a(s,i),i]):e.push([function(t,e,n){return i=>{const{value:a}=n;t.setAttribute(e,a(i))}}(s,n,i),i])}),e}(i(t)),n=this.deleteItemFromLoop.bind(this);this.loop.push(...function(t,e){const n=[];return t.forEach(t=>{const[i,a]=t;a.range?n.push(s(i,a,e)):n.push(i)}),n}(e,n))},o.prototype.deleteItemFromLoop=function(t){this.loop.splice(this.loop.indexOf(t),1),this.loop<1&&this.end()},o.prototype.interfaceControler=function(){const t=function(t,i){const a=e("g"),s=e("polygon"),r=e("polygon");n(s,["points","0,0 0,-20 20,-10 20,-10"]),n(r,["points","0,0 0,-20 20,-10 20,-10"]),a.appendChild(s),a.appendChild(r);const o=e("rect");n(o,["x","0"],["y","-20"],["width","20"],["height","20"],["fill-opacity","0"]);const c=e("g");return c.appendChild(a),c.appendChild(o),function(){const t=i.viewBox.baseVal,e=i.createSVGMatrix();e.e=t.x+.05*t.width,e.f=t.y+.95*t.height;const n=t.height/400;e.a=n,e.d=n,c.transform.baseVal.initialize(i.createSVGTransformFromMatrix(e))}(),function(){n(a,["fill",t.interfaceColor]);const{matrix:e}=c.transform.baseVal.getItem(0);e.a*=t.interfaceSize,e.d*=t.interfaceSize,"auto"!==t.interfacePosition&&([e.e,e.f]=t.interfacePosition),c.transform.baseVal.getItem(0).setMatrix(e)}(),i.appendChild(c),{play:function(){function e(){n>=0?(s.setAttribute("points",`${n/10},0 ${n/10},-20 ${10-n/10},${-15-n/2} ${10-n/10},${n/2-5}`),r.setAttribute("points",`${10+n/10},${n/2-5} ${10+n/10},${-15-n/2} ${20-n/10},${-10-n} ${20-n/10},${-10+n}`),n-=1,window.requestAnimationFrame(e)):(s.setAttribute("points","0,0 0,-20 20,-10 20,-10"),r.setAttribute("points","0,0 0,-20 20,-10 20,-10"))}let n=10;t.interfaceAnimation||(n=1),e()},pause:function(){function e(){n<=10&&(s.setAttribute("points",`${n/10},0 ${n/10},-20 ${10-n/10},${-15-n/2} ${10-n/10},${n/2-5}`),r.setAttribute("points",`${10+n/10},${n/2-5} ${10+n/10},${-15-n/2} ${20-n/10},${-10-n} ${20-n/10},${-10+n}`),n+=1,window.requestAnimationFrame(e))}let n=1;t.interfaceAnimation||(n=10),e()},off:function(){function e(){i<=10?(s.setAttribute("points",`1,${-i} 1,${-20+i} 9,${-20+i} 9,${-i}`),r.setAttribute("points",`11,${-i} 11,${-20+i} 19,${-20+i} 19,${-i}`),i+=1,window.requestAnimationFrame(e)):n(a,["display","none"])}let i=1;t.interfaceAnimation||(i=10),e()},on:function(){function e(){i>=0?(s.setAttribute("points",`0,${-i} 0,${-20+i} 20,-10 20,-10`),r.setAttribute("points",`0,${-i} 0,${-20+i} 20,-10 20,-10`),i-=1,window.requestAnimationFrame(e)):(s.setAttribute("points","0,0 0,-20 20,-10 20,-10"),r.setAttribute("points","0,0 0,-20 20,-10 20,-10"))}let i=10;t.interfaceAnimation||(i=0),n(a,["display","block"]),e()},button:o}}(this.settings,this.svg),i=function(t,i){const a=e("marker");a.id="arrow",n(a,["viewBox","0 0 10 10"],["refX","1"],["refY","5"],["markerWidth","3"],["markerHeight","3"],["orient","auto"]);const s=e("path");n(s,["d","M 0 0 L 10 5 L 0 10 z"]),a.appendChild(s);const r=e("g"),o=e("path"),c=e("path");n(o,["d","M0 -10 a 10 10, 90 0 1 10 -10"],["marker-end","url(#arrow)"],["stroke-dasharray","15"]),n(c,["d","M20 -10 a 10 10, 90 0 1 -10 10"],["marker-end","url(#arrow)"],["stroke-dasharray","15"]),r.appendChild(o),r.appendChild(c),n(r,["fill","none"],["stroke-width","2"],["transform","translate(30, 0)"],["display","none"]);const u=e("rect");n(u,["x","0"],["y","-20"],["width","20"],["height","20"],["fill-opacity","0"],["transform","translate(30, 0)"]);const l=e("g");l.appendChild(r),l.appendChild(u);let h=i.getElementsByTagName("defs")[0];return h||(h=e("defs"),i.insertBefore(h,i.firstChild)),function(){const t=i.viewBox.baseVal,e=i.createSVGMatrix();e.e=t.x+.05*t.width,e.f=t.y+.95*t.height;const n=t.height/400;e.a=n,e.d=n,l.transform.baseVal.initialize(i.createSVGTransformFromMatrix(e))}(),function(){n(r,["stroke",t.interfaceColor]),n(a,["fill",t.interfaceColor]);const{matrix:e}=l.transform.baseVal.getItem(0);e.a*=t.interfaceSize,e.d*=t.interfaceSize,"auto"!==t.interfacePosition&&([e.e,e.f]=t.interfacePosition),l.transform.baseVal.getItem(0).setMatrix(e)}(),h.appendChild(a),i.appendChild(l),{off:function(){function e(){i<=10?(o.setAttribute("stroke-dashoffset",1.5*-i),c.setAttribute("stroke-dashoffset",1.5*-i),i+=1,window.requestAnimationFrame(e)):n(r,["display","none"])}let i=1;t.interfaceAnimation||(i=10),e()},on:function(){function e(){i>=0&&(o.setAttribute("stroke-dashoffset",1.5*-i),c.setAttribute("stroke-dashoffset",1.5*-i),i-=1,window.requestAnimationFrame(e))}n(r,["display","block"]);let i=10;t.interfaceAnimation||(i=1),e()},button:u}}(this.settings,this.svg),a=this;return t.button.addEventListener("click",function(){"not started"===a.status||"paused"===a.status?a.play():"playing"===a.status&&a.pause()},!1),i.button.addEventListener("click",function(){"playing"!==a.status&&"paused"!==a.status&&"ended"!==a.status||a.refresh()},!1),{playPause:t,refresh:i}},o.prototype.add=function(...t){const e=new Set;t.forEach(t=>{if(!Object.prototype.hasOwnProperty.call(t,"object"))throw new Error(`Object ${t} must have "object" property. which is query selector or actual DOM object`);const n="string"==typeof t.object?document.querySelector(t.object):t.object;if(!document.contains(n))throw new Error(`Cannot find ${"string"==typeof t.object?`DOM element that match "${t.object}" query selector`:`${t.object} in DOM`}`);const i=new c(n);if(!Object.prototype.hasOwnProperty.call(t,"animation"))throw new Error(`Object ${t} must have "animation" property`);i.animation=t.animation,this.svg||(this.svg=function(t){let e=t.item;for(;e.tagName;){if("svg"===e.tagName.toLowerCase())return e;e=e.parentNode}throw new Error("Cannot find SVG element! All animated elements must have SVG parent")}(i)),e.add(i),i.setVariables(),i.initMatrix(this.svg),i.decomposeMatrix(),this.objectList.add(i)}),"function"==typeof this.interfaceControler&&this.settings.showInterface&&(this.interfaceControler=this.interfaceControler()),this.dispatcher(e)},o}();